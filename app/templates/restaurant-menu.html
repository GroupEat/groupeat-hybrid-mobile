<ion-view ng-controller='RestaurantMenuCtrl'  title="{{ 'restaurantMenu' | translate }}" hide-back-button="true">

<!-- - - - - - - - - - - - - - - - - - - NAV BAR - - - - - - - - - - - - - - - - - -->

  <ion-nav-buttons side="left">
    <button class="button button-clear ion-ios-arrow-back" on-tap="onLeaveRestaurant()"> {{ 'back' | translate }}
    </button>
  </ion-nav-buttons>

<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

<ge-loading-backdrop ng-show="loadingBackdrop.show">
</ge-loading-backdrop>

<!-- - - - - - - - - - - - - - - - - - - SUB HEADER BAR - - - - - - - - - - - - - - - - - -->

  <md-content class="has-header" ng-hide="messageBackdrop.show">
    <md-item ng-hide="isNewOrder.value">
      <md-item-content layout="row" layout-wrap>
        <div flex="25" class="rm-sub-header-content">
          <h3 class="rm-sub-header-text">
            <i class="ion-arrow-graph-down-right energized"></i>
            {{ currentOrder.currentDiscount }} %
          </h3>
        </div>
        <div flex="25" class="rm-sub-header-content">
          <h3 class="rm-sub-header-text">
            <i class="ion-android-stopwatch energized"></i>
            <timer countdown="getTimeDiff(currentOrder.endingAt)" max-time-unit="'minute'" interval="1000" id="chrono-syle"> {{mminutes}}:{{sseconds}} </timer>
          </h3>
        </div>
        </div>
        <div flex="25" class="rm-sub-header-content">
          <h3 class="rm-sub-header-text">
            <ng-pluralize count="cart.getTotalQuantity()" when="{'0': ' 0 Pizza', '1': ' 1 Pizza', 'other': '{{ cart.getTotalQuantity() }} Pizzas'}" ></ng-pluralize>
          </h3>
        </div>
        <div flex="25" class="rm-sub-header-content">
          <h3 class="rm-sub-header-text">
            {{ cart.getTotalPrice() | number : 2}}€
          </h3>
        </div>
      </md-item-content>
    </md-item>


    <md-item ng-show="isNewOrder.value">
      <md-item-content layout="row" layout-wrap>
        <div flex="20">
        </div>
        <div flex="20" class="rm-sub-header-content">
          <h3 class="rm-sub-header-text">
            <ng-pluralize count="cart.getTotalQuantity()" when="{'0': ' 0 Pizza', '1': ' 1 Pizza', 'other': '{{ cart.getTotalQuantity() }} Pizzas'}" ></ng-pluralize>
          </h3>
        </div>
        <div flex="20">
        </div>
        <div flex="20" class="rm-sub-header-content">
          <h3 class="rm-sub-header-text">
            {{ cart.getTotalPrice() | number : 2}}€
          </h3>
        </div>
        <div flex="20">
        </div>
      </md-item-content>
    </md-item>

    <h6 class="rm-sub-header-energized-divider"></h6>
<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->


<!-- - - - - - - - - - - - - - - - - - - LIST OF PRODUCTS - - - - - - - - - - - - - - - - - -->

    <ion-scroll direction="y">
    <md-list>
      <md-item ng-repeat="product in products">
        <md-item-content layout="row" layout-wrap on-tap="toggleDetails(product)" ng-class="{active: areDetailsShown(product)}" >
          <div flex="90" class="md-tile-content">
              <h3> {{ product.name }} </h3>
              <h4> {{ product.description }} </h4>
          </div>
          <div flex="10" ng-show="cart.hasAtLeastOneProduct(product)" class="icon-height">
              <i class="icon ion-ios-checkmark-empty assertive"></i>
          </div>
        </md-item-content>

        <md-divider></md-divider>

        <md-list>
          <md-item ng-repeat="format in product.formats.data" ng-show="areDetailsShown(product)">
            <md-item-content layout="row" layout-wrap>
                <div flex="60" ng-show="isNewOrder.value" class="md-tile-content">
                  {{ format.name }} ({{ format.price }} €)
                </div>
                <div flex="60" ng-hide="isNewOrder.value" class="md-tile-content">
                  {{ format.name }} (<strike>{{ format.price }}€</strike> {{ format.price*(100-currentOrder.currentDiscount)/100 | number : 2}} €)
                </div>

                <div flex="10">
                  <a class="ion-ios-minus-outline assertive icon-cart-add-delete align-right" on-tap="onDeleteProduct(product, format.id)"></a>
                </div>
                <div flex="10">
                  <a class="center">{{ cart.getFormatQuantity(format.id) }}</a>
                </div>
                <div flex="10">
                  <a class="icon ion-ios-plus-outline assertive icon-cart-add-delete" on-tap="onAddProduct(product, format)"></a>
                </div>
                <div flex="10">
                </div>
            </md-item-content>
            <md-divider></md-divider>
          </md-item>
        </md-list>
      </md-item>
    </md-list>
    </ion-scroll>

    <div class="center cart-button">
      <style scoped>
          .md-button { padding: 3px; }
          .md-button.md-default-theme.md-fab { background-color: #e67e22; }
      </style>
      <md-button class="md-fab" ui-sref="cart">
        <i class="button button-clear ion-ios-cart-outline right-header-bar-icon" ></i>
      </md-button>
    </div>
  </md-content>

<!-- - - - - - - - - - - - - - - - - - - BACKDROP MESSAGE - - - - - - - - - - - - - - - - - -->

  <ion-content has-header="true" scroll="false" ng-show="messageBackdrop.show">
    <ge-message-backdrop>
    </ge-message-backdrop>
  </ion-content>

<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

</ion-view>
